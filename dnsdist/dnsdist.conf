-- Enable console access
setKey("M2YQKiPEDzeWHUFjejVOd+QHmMVmm2SuYG7vSXdaIkE=")

-- Enable web server for API access
webserver("0.0.0.0:8083")
setWebserverConfig({password="admin", apiKey="MySecretAPIKey123"})

-- Enable control socket (for dnsdist -c)
controlSocket("0.0.0.0:5199")
setConsoleACL({'0.0.0.0/0', '::/0'})

-- Set ACL to allow queries from Docker network
setACL({'0.0.0.0/0'})

-- Add upstream DNS servers with health checks
newServer({
  address="8.8.8.8",
  name="google-dns-1",
  checkInterval=30,
  checkTimeout=2,
  maxCheckFailures=3
})

newServer({
  address="1.1.1.1",
  name="cloudflare-dns",
  checkInterval=30,
  checkTimeout=2,
  maxCheckFailures=3
})

-- Enable verbose logging
setVerboseHealthChecks(true)
setVerbose(true)

-- Simple load balancing policy
setServerPolicy(roundrobin)

-- Log queries
addAction(AllRule(), LogAction("/var/log/dnsdist/queries.log", false, true, true))