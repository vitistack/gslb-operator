name: Build and Test

on:
    push:
        branches: ["main", "develop"]
    pull_request:
        branches: ["main", "develop"]

jobs:
    build-and-test:
        runs-on: ubuntu-latest
        steps:
            - name: checkout code
              uses: actions/checkout@v4

            - name: setup Go
              uses: actions/setup-go@v5
              with:
                  go-version: 1.25
                  cache: true
                  cache-dependency-path: go.sum

            - name: install dependencies
              run: go mod download
            
            - name: build
              run: |
                #test version not in use for release
                export VERSION=test-$(git rev-parse --short HEAD)
                make build

            - name: test
              run: go test -v ./...
